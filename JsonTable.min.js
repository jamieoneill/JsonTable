!function(e){e.fn.JsonTable=async function(t){e("head").append('<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">'),e("head").append('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/css/bootstrap-multiselect.css">'),e("head").append('<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css"/>'),e("head").append('<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.dataTables.min.css"/>'),e("head").append('<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">'),e("head").append('<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jamieoneill/JsonTable/style.css">'),await e.getScript("https://cdn.jsdelivr.net/npm/sweetalert2@9");var a,n=e.extend({DivID:"#"+e(this)[0].id,colsToHide:[]},t);Swal.fire({title:"Fetching data",timerProgressBar:!0,target:document.querySelector(n.DivID),onBeforeOpen:()=>{Swal.showLoading(),Swal.getContainer().style.position="absolute"},allowOutsideClick:!1}).then(e=>{}),await e.getScript("https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"),await e.getScript("https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"),await e.getScript("https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/js/bootstrap-multiselect.js"),await e.getScript("https://cdn.datatables.net/v/dt/dt-1.10.20/datatables.min.js"),await e.getScript("https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"),await e.getScript("https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"),await e.getScript("https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"),await async function(){e(n.DivID).append('\n      <div class="row" style="margin-bottom: 15px">          \n        <div class="col-md-12">\n            <div class="card">\n                <div class="card-header">\n                    Filter \n                </div>\n                <div class="card-body">\n                    <form id="filtHolder"></form>\n                    <button class="btn btn-primary" id="addFilter">+ Filter</button> \n                    <button class="btn btn-danger" id="clearFilters">Clear All</button>                                               \n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="row">            \n        <div class="col-md-12" >\n            <table id="jsonTable" class="table table-bordered table-hover">\n                <thead></thead>\n                <tbody></tbody>\n            </table>\n        </div>\n    </div>'),e(n.DivID).addClass("json-table-holder")}();var o,l=[],s=[],i=!0;if(n.dataURL)e.ajax(n.dataURL,{method:"GET",headers:{authorization:n.token}}).then(function(e){n.responseField?(content=e[n.responseField],n.dataURL.includes("github")?(a=JSON.parse(atob(content)),gitSha=e.sha):a=content):a=e;var t=[];Array.isArray(a)?t=a:t.push(a),d(a=t)}).catch(function(e){console.error(e)});else{var r=[];Array.isArray(n.data)?r=n.data:r.push(n.data),d(a=r)}function d(t){o&&(o.destroy(),e("#jsonTable tr").remove());var a="<tr>";Object.keys(t[0]).forEach(function(t,o){l.push(t),-1!=e.inArray(t,n.colsToHide)?a+='<th style="display:none" class="Col-'+o+'">'+t+"</th>":a+='<th class="Col-'+o+'">'+t+"</th>"}),a+="</tr>",e("#jsonTable thead").append(a),t.forEach(function(t,a){var o='<tr id="row-'+a+'">';for(const[s,[i,r]]of Object.entries(Object.entries(t)))if(flattenedValue=c(r),Object.keys(flattenedValue).length>1){-1!=e.inArray(i,n.colsToHide)?o+='<td class="Col-'+s+'"  style="display:none">':o+='<td class="Col-'+s+'">';var l=!0;for(const e in flattenedValue)flattenedValue.hasOwnProperty(e)&&(l?""!=flattenedValue[e]&&(l=!1,o+=flattenedValue[e]+' <label class="btn" data-toggle="collapse" data-target="#accordion'+a+s+'"><span class="dropdown-icon"></span></label>'):o+='<span id="accordion'+a+s+'" class="collapse">'+flattenedValue[e]+' </span><hr class="small">');o+="</td>"}else-1!=e.inArray(i,n.colsToHide)?o+='<td class="Col-'+s+'" style="display:none">'+Object.values(flattenedValue)[0]+"</td>":o+='<td class="Col-'+s+'">'+Object.values(flattenedValue)[0]+"</td>";o+="</tr>",e("#jsonTable tbody").append(o)}),o=e("#jsonTable").DataTable({paging:!1,info:!1,dom:"Bfrtip",buttons:[{extend:"excelHtml5",text:"Export",className:"btn",exportOptions:{columns:":visible"}}]}),function(){var t=document.createElement("label");t.textContent="Display: ",t.style.marginRight="10px";var a=document.createElement("select");a.setAttribute("multiple","multiple"),a.id="colSelector";for(var o=0;o<l.length;o++){var s=document.createElement("option");s.value=o,s.text=l[o],n.colsToHide.includes(l[o])||s.setAttribute("selected","selected"),a.appendChild(s)}t.appendChild(a),e("#jsonTable_filter").prepend(t),e("#colSelector").multiselect({templates:{li:'<li class="dropdown-item"><a><label style="margin:100px" class="m-0 pl-2 pr-0"></label></a></li>',ul:'<ul class="multiselect-container dropdown-menu p-1 m-0"></ul>'},onChange:function(t,a){colID=t[0].value;for(var n=document.getElementsByClassName("Col-"+colID),o=0;o<n.length;o++)a?e(n[o]).show():e(n[o]).hide()}}),e("#jsonTable_filter").children()[1].children[0].className="form-control"}(),function(e){switch(Swal.close(),e){case"No version files found on Github":Swal.fire("Error",e,"error")}}()}function c(e){var t={};return function e(a,n){if(Object(a)!==a)t[n]=a;else if(Array.isArray(a)){for(var o=0,l=a.length;o<l;o++)e(a[o],n?n+"."+o:""+o);0==l&&(t[n]=[])}else{var s=!0;for(var i in a)s=!1,e(a[i],n?n+"."+i:i);s&&(t[n]={})}}(e,""),t}function p(e){newTable='<table id="tempTable" class="table table-bordered"> <tbody>',flattenedValue=c(a[e]);for(const t in flattenedValue)flattenedValue.hasOwnProperty(t)&&(newTable+="<tr><td>"+t+'</td><td><input class="form-control updateProject'+e+'" keyName="'+t+'" value="'+flattenedValue[t]+'"></input></td></tr>');return newTable+="</tbody></table>",newTable}function u(t){var a='{"message":"adding new project","content":"'+btoa(JSON.stringify(t))+'","sha":"'+gitSha+'", "branch": "master"}';e.ajax({url:n.dataURL,type:"PUT",beforeSend:function(e){e.setRequestHeader("Authorization",n.token)},data:a}).then(function(e){Swal.fire("Success","data updated","success")}).catch(function(e){n.token?Swal.fire("Error","Something went wrong. view console for more details","error"):Swal.fire("Error","No git token has been set","error"),console.error(e)})}e("#clearFilters").click(function(){for(var t=document.getElementById("filtHolder");t.firstChild;)t.removeChild(t.lastChild);i=!0,s=[],e("jsonTable tbody tr").show()}),e("#addFilter").click(function(){var t=Math.floor(1e4*Math.random()),n=document.createElement("div");if(n.className="row",i){(o=document.createElement("div")).className="col-md-1";r={value:"OR"};n.appendChild(o)}else{var o,r;(o=document.createElement("div")).className="col-md-1",(r=document.createElement("select")).className="form-control",r.id="query-"+t;var d=document.createElement("option");d.value="AND",d.text="AND",r.appendChild(d);var c=document.createElement("option");c.value="OR",c.text="OR",r.appendChild(c),o.appendChild(r),n.appendChild(o)}i=!1;var p=document.createElement("div");p.className="col-md-5";var u=document.createElement("select");u.className="form-control",u.id="filter-"+t;for(var h=0;h<l.length;h++){var m=document.createElement("option");m.value=h,m.text=l[h],u.appendChild(m)}p.appendChild(u),n.appendChild(p);var f=document.createElement("div");f.className="col-md-5";var b=document.createElement("select");b.setAttribute("multiple","multiple"),b.id="options-"+t,e.each(a,function(e,t){var a=document.createElement("option");a.value=Object.values(t)[0],a.text=Object.values(t)[0],b.appendChild(a)}),f.appendChild(b),n.appendChild(f),document.getElementById("filtHolder").appendChild(n),e("#options-"+t).multiselect({enableFiltering:!0,filterBehavior:"text",includeResetOption:!0,includeResetDivider:!0,resetText:"Clear",buttonWidth:"400px",buttonContainer:'<div class="dropdown" />',templates:{li:'<li class="dropdown-item"><a><label class="m-0 pl-2 pr-0"></label></a></li>',ul:'<ul class="multiselect-container dropdown-menu p-1 m-0"></ul>'},onChange:function(a,n){var o,l=[];e("#options-"+t+" option:selected").each(function(){l.push(e(this).val())}),thisFilter={col:u.value,values:l,query:r.value},o=thisFilter,e("#jsonTable tbody tr").hide(),s.forEach(function(e,t){e.col===o.col&&s.splice(t,1)}),s.push(o),e("#jsonTable tbody tr").each(function(){row=e(this),s.forEach(function(e,t){0==e.values.length?s.splice(t,1):(td=row.find("td.Col-"+e.col)[0],"OR"==e.query?(td.innerHTML.includes("<span")?found=e.values.some(e=>td.textContent.split(" ").includes(e)):found=e.values.includes(td.textContent),found&&row.show()):"AND"==e.query&&row.is(":visible")&&(td.innerHTML.includes("<span")?found=e.values.some(e=>td.textContent.split(" ").includes(e)):found=e.values.includes(td.textContent),found||row.hide()))})}),0==s.length&&e("#jsonTable tbody tr").show()}}),e("*[id*=filter]").change(function(){optionsID=e(this)[0].id.replace("filter","options"),optionsCategory=parseInt(e(this).val()),newValues=[],e.each(a,function(e,t){thisValue=Object.values(t)[optionsCategory],-1===newValues.indexOf(thisValue)&&newValues.push(thisValue)}),e("#"+optionsID).empty().populate(newValues),e("#"+optionsID).multiselect("rebuild")})}),e("#jsonTable").on("click","tbody tr",function(t){"TD"==t.target.tagName&&(rowID=e(this)[0].id.replace("row-",""),n.dataURL&&n.dataURL.includes("github")?(showUploadButton=!0,showDeleteButton=!0):(showUploadButton=!1,showDeleteButton=!1),(async()=>{Swal.fire({title:"<strong>Details</strong>",html:p(rowID),width:"70%",showCancelButton:showDeleteButton,showConfirmButton:showUploadButton,showCloseButton:!0,confirmButtonColor:"#3085d6",confirmButtonText:"Update",cancelButtonColor:"#d33",cancelButtonText:"Delete",focusConfirm:!1,preConfirm:()=>[e(".updateProject"+rowID)]}).then(t=>{t.dismiss===Swal.DismissReason.cancel?(a.splice(rowID,1),u(a),d(a)):t.value&&(updatedProject={},t.value[0].each(function(){array=e(this).attr("keyName").split("."),function(e,t,a){lastKeyIndex=t.length-1;for(var n=0;n<lastKeyIndex;++n)key=t[n],key in e||(e[key]={}),e=e[key];e[t[lastKeyIndex]]=a}(updatedProject,array,e(this).val())}),a[rowID]=updatedProject,u(a),d(a))})})())}),function(e){function t(t,a,n){t.forEach(t=>{var o=!1;""!=t&&(0==e('optgroup[name="'+n[0].id+a+'"]').length&&n.append(e('<optgroup name="'+n[0].id+a+'" label="'+a+'">')),0==e('optgroup[name="'+n[0].id+a+'"] option').length?e('optgroup[name="'+n[0].id+a+'"]').append(e("<option>",{text:t,value:t})):(e('optgroup[name="'+n[0].id+a+'"] option').each(function(){e(this).val()==t&&(o=!0)}),o||e('optgroup[name="'+n[0].id+a+'"').append(e("<option>",{text:t,value:t}))))})}e.fn.populate=function(a){var n=!1;if(a.forEach(e=>{"object"==typeof e&&(n=!0)}),!n)return this.append(a.map(t=>e("<option>",{text:t,value:t})));Object.keys(a[0]).forEach(t=>this.append(e('<optgroup name="'+e(this)[0].id+t+'" label="'+t+'">'))),a.forEach(e=>{for(const a in e)values=[],Array.isArray(e[a])?"object"==typeof e[a][0]?Object.entries(e[a][0]).forEach(e=>{t([e[1]],a+"-"+e[0],this)}):t(e[a],a,this):"object"==typeof e[a]?Object.entries(e[a]).forEach(e=>{Array.isArray(e[1])?e[1].forEach(a=>{Object.entries(a).forEach(a=>{t([a[1]],e[0]+"-"+a[0],this)})}):"object"==typeof e[1]?Object.entries(e[1]).forEach(a=>{t([a[1]],e[0]+"-"+a[0],this)}):t([e[1]],e[0],this)}):t([e[a].toString()],a,this)}),e("optgroup").each(function(){0==e(this).children().length&&e(this).remove()})}}(jQuery)}}(jQuery);
